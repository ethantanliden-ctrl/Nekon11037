<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>轴心 巴巴罗萨通讯工具</title>
    <style>
        body {
            font-family: "Helvetica", sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            resize: vertical;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>轴心 巴巴罗萨通讯工具</h1>

    <textarea id="textInput" placeholder="输入文本或摩斯码，例如：你好 或 .... . .-.. .-.. --- / .-- --- .-. .-.. -.."></textarea>

    <div>
        <button onclick="textToMorse()">文字 → 摩斯码</button>
        <button onclick="morseToText()">摩斯码 → 文字</button>
        <button onclick="playMorse()">播放声音</button>
        <button onclick="copyResult()">复制结果</button>
    </div>

    <h3>转换结果:</h3>
    <textarea id="result" readonly></textarea>

    <script>
        // 基础英文摩斯码映射
        const morseCodeMap = {
            'A': '.-',    'B': '-...',  'C': '-.-.', 'D': '-..',
            'E': '.',     'F': '..-.',  'G': '--.',  'H': '....',
            'I': '..',    'J': '.---',  'K': '-.-',  'L': '.-..',
            'M': '--',    'N': '-.',    'O': '---',  'P': '.--.',
            'Q': '--.-',  'R': '.-.',   'S': '...',  'T': '-',
            'U': '..-',   'V': '...-',  'W': '.--',  'X': '-..-',
            'Y': '-.--',  'Z': '--..',
            '0': '-----', '1': '.----', '2': '..---', '3': '...--',
            '4': '....-', '5': '.....', '6': '-....', '7': '--...',
            '8': '---..', '9': '----.'
        };

        const reverseMorseCodeMap = {};
        for (let key in morseCodeMap) {
            reverseMorseCodeMap[morseCodeMap[key]] = key;
        }

        // 简单拼音映射（可扩展）
        const pinyinMap = {
            '你': 'NI', '好': 'HAO', '是': 'SHI', '我': 'WO', '爱': 'AI', '中': 'ZHONG', '国': 'GUO'
        };

        function chineseToPinyin(text) {
            return text.split('').map(char => pinyinMap[char] || '?').join(' ');
        }

        function textToMorse() {
            let input = document.getElementById('textInput').value.toUpperCase();
            // 如果包含中文字符，先转拼音
            if (/[^\x00-\x7F]/.test(input)) {
                input = chineseToPinyin(input);
            }

            let output = '';
            for (let char of input) {
                if (char === ' ') {
                    output += ' / ';
                } else if (morseCodeMap[char]) {
                    output += morseCodeMap[char] + ' ';
                } else {
                    output += '? ';
                }
            }
            document.getElementById('result').value = output.trim();
        }

        function morseToText() {
            const input = document.getElementById('textInput').value.trim();
            const words = input.split(' / ');
            let output = '';
            for (let word of words) {
                let letters = word.trim().split(' ');
                for (let letter of letters) {
                    if (reverseMorseCodeMap[letter]) {
                        output += reverseMorseCodeMap[letter];
                    } else {
                        output += '?';
                    }
                }
                output += ' ';
            }
            document.getElementById('result').value = output.trim();
        }

        function playMorse() {
            const morse = document.getElementById('result').value;
            const dotDuration = 100; // 毫秒
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            let time = audioCtx.currentTime;

            for (let char of morse) {
                if (char === '.') {
                    playBeep(audioCtx, time, dotDuration);
                    time += (dotDuration + 50) / 1000;
                } else if (char === '-') {
                    playBeep(audioCtx, time, dotDuration * 3);
                    time += (dotDuration * 3 + 50) / 1000;
                } else if (char === ' ') {
                    time += 0.2;
                } else if (char === '/') {
                    time += 0.5;
                }
            }
        }

        function playBeep(audioCtx, startTime, duration) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, startTime);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start(startTime);
            oscillator.stop(startTime + duration / 1000);
        }

        function copyResult() {
            const result = document.getElementById('result');
            result.select();
            document.execCommand('copy');
            alert('已复制结果！');
        }
    </script>
</body>
</html>

